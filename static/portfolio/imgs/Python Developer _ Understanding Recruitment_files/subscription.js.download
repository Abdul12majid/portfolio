$(function() {
    var havePreviouslySignedInKeyName = "HavePreviouslySignedIn";

    if($.subscriptions("ajax-login").length > 0) {
        
        
        if(localStorage.getItem(havePreviouslySignedInKeyName) === null){
            
                if(window.location.pathname.indexOf('dashboard') > 0){
                    localStorage.setItem(havePreviouslySignedInKeyName, "true");
                }
            
           
            
        }
        
        if(localStorage.getItem(havePreviouslySignedInKeyName))
        {
            $.ajax({
                url: "/candidate/login-status/",
                method: "post",
                }).then(function(res) {
                    if(res && res.isLoggedIn == true)
                    {
                        localStorage.setItem(havePreviouslySignedInKeyName, "true");
                    }                
                    $.publish('ajax-login', { response: res });
                }).catch(function(err) {
                    $.publish('ajax-login-error', { error: err });
                });
        }
        else
        {
            var mockResponseObj = {
                isLoggedIn: false,
                loginUrl: '/login/'
            };
            $.publish('ajax-login', { response: mockResponseObj });
        }
    }
});